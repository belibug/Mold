name: Pester Tests

# Controls when the workflow will run
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

defaults:
  run:
    shell: pwsh

jobs:
  Tests:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Install ModuleTools module form PSGallery
        run: Install-PSResource -Repository PSGallery -Name ModuleTools -TrustRepository

      - name: ğŸ—ï¸ Build Module
        run: Invoke-MTBuild -Verbose

      - name: ğŸ“ Generate Report
        run: |
          # Get list of files in the dist directory directory
          $Report = New-MDHeader -Text "Output Files ğŸ“" -Level 2
          $Report += Get-ChildItem -Path ./dist -Recurse | Select-Object Name, Directory | New-MDTable 
          Set-Content -Path $GITHUB_STEP_SUMMARY -Value $Report

      - name: ğŸ§ª Run Pester Tests
        run: Invoke-MTTest